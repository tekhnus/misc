<!doctype html>
<html>
  <head>
    <title>jq test</title>
    <script type="text/javascript" src="../build/jq.js"></script>
    <script type="text/javascript">
      output_to_page = function(text) {
          var outp = document.createElement("li")
          outp.appendChild(document.createTextNode(text))
          document.getElementById("output").appendChild(outp);
      }

      create_jq().then(function(jq) {
          var query = ".x";
          var inputs = [`{"x": [3, 14, 15]}`, `{"x": "hello"}`];

          var state = jq.jq_init();
          var result = jq.jq_compile(state, query);
          if (result != 1) {
              output_to_page("could not compile");
              return;
          }

          for (var input of inputs) {
              var inp = jq.jv_parse(input);
              if (jq.jv_get_kind(inp) == 0) {
                  output_to_page("invalid input");
                  return;
              }

              jq.jq_start(state, inp, 0);
              var output;
              while (output = jq.jq_next(state), jq.jv_get_kind(output) != 0) {
                  output_to_page(jq.jv_dump_string_trunc(output, 1024));
              }
          }
      });
    </script>
  </head>
  <body>
    <ul id="output">
    </ul>
  </body>
</html>
