#!/bin/bash

parentpid=$1
while true;
do
	IFS= read -r cmd
	if [ -z "$cmd" ]; then
		break
	fi
  # We do a zero-byte read from tty
  # to create a synchronization point.
  # This command will return only when the process
  # is foregrounded.
  dd bs=1 count=0 </dev/tty 2>/dev/null
	eval "$cmd" </dev/tty
	kill -STOP -- -$parentpid
done </tmp/crsh-command
