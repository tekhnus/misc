#!/bin/bash
rm -rf /tmp/crsh-command
mkfifo /tmp/crsh-command

rm -rf /tmp/crsh-result
mkfifo /tmp/crsh-result

{
  echo "init"
	while true;
	do
		IFS= read -r cmd
	  echo "server did read a command $cmd" >>/tmp/crsh-log
		if [ -z "$cmd" ]; then
			break
		fi
    # Also wait a bit.
		sleep 1
	  echo 'server will eval' >>/tmp/crsh-log
		eval "$cmd" </dev/tty >/dev/tty
		status="$?"
	  echo 'server did eval' >>/tmp/crsh-log
		echo "$status"
	  echo 'server did send status' >>/tmp/crsh-log
	done
} </tmp/crsh-command >/tmp/crsh-result
