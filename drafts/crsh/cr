#!/usr/bin/env bash

if [[ ! -z $(git status --porcelain) ]]; then
  git add .
  git ci -m do
fi

[[ -z $(git status --porcelain) ]] || exit
VERSION="$(git rev-parse HEAD)"
echo $VERSION >cmd/crsh/git-head.txt

mkdir -p darwin
go build -o darwin ./... || exit
mkdir -p linux
GOOS=linux GOARCH=amd64 go build -o linux ./... || exit

BIN=~/.local/bin

rm $BIN/crsh*
cp darwin/* $BIN

SHARE=~/.local/share/crsh/$VERSION

rm -rf $SHARE
mkdir -p $SHARE
cp -r darwin linux $SHARE

kitty @ launch \
  --type os-window \
  --env "PATH=$PATH" \
  crsh manager "$@"