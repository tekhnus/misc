#!/bin/bash
set -m

function get_pid() {
  exec sh -c 'echo "$PPID"'
}

( while true; do read -p '> ' -r line; echo "$line" >/tmp/crsh-command; kill -STOP $(get_pid); done )
( ./crsh-server "$(get_pid)" ) 

while true; do
  fg %- >/dev/null
done
