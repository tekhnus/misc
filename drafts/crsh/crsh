#!/bin/bash
echo '' >>/tmp/crsh-log
echo 'STARTING NEW SESSION' >>/tmp/crsh-log
echo '' >>/tmp/crsh-log

sleep 2  # So that the fifos are initialized

echo "master will enter the loop" >>/tmp/crsh-log
while true; do
  echo "master will read a line" >>/tmp/crsh-log
  kitty @ focus-window
  read -p '> ' -r line </dev/tty >/dev/tty
  echo "master did read a line $line" >>/tmp/crsh-log
  clear >/dev/tty </dev/tty
  kitty @ focus-window -m "cmdline:.*crsh-.*"
  echo "$line"
  echo "master did send the line" >>/tmp/crsh-log
  IFS= read -r res
  echo "master did read the result $res" >>/tmp/crsh-log
done >/tmp/crsh-command </tmp/crsh-result 
