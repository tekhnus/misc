#!/bin/bash
echo '' >>/tmp/crsh-log
echo 'STARTING NEW SESSION' >>/tmp/crsh-log
echo '' >>/tmp/crsh-log

( sleep 1; ./crsh-server ) &
disown

sleep 2  # So that the fifos are initialized

echo "master will enter the loop" >>/tmp/crsh-log
while true; do
  echo "master will read a line" >>/tmp/crsh-log
  read -p '> ' -r line </dev/tty >/dev/tty
  echo "master did read a line $line" >>/tmp/crsh-log
  echo "$line"
  echo "master did send the line" >>/tmp/crsh-log
  IFS= read -r res
  echo "master did read the result" >>/tmp/crsh-log
done >/tmp/crsh-command </tmp/crsh-result 
